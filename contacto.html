<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/style_contacto.css">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Crimson+Pro">

    <link rel="shortcut icon" href="./imagenes/favicon.ico" type="image/x-icon">
    <script src="https://kit.fontawesome.com/f17c74b586.js" crossorigin="anonymous"></script>
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <title>Pierrot Contacto</title>
</head>


<body>
    <header class="header">
        <div class="header-logo animate__animated animate__heartBeat"> <a href="./index.html"> <img src="./imagenes/Pierrot Logo 2.png" alt="logo"></a></div>
        <nav class="header-menubar">
            <ul>
                <li> <a href="index.html">Inicio</a></li>
                <li> <a href="sabores.html">Sabores</a></li>
                <li> <a href="nosotros.html">Nuestra Historia</a></li>
                <li> <a href="contacto.html">Contacto</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 col-lg-6 formulario">
                    <h1>Escribe tu consulta:</h1>
                    <form id="formulario" enctype="multipart/form-data" >

                        <div class="mb-3">
                            <label for="DNI" class="form-label">DNI:</label>
                            <input type="text" class="form-control" id="DNI" placeholder="Escribe tu DNI.." required>
                        </div>
                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre:</label>
                            <input type="text" class="form-control" id="nombre" placeholder="Escribe tu nombre.." required>
                        </div>
                        <div class="mb-3">
                            <label for="apellido" class="form-label">Apellido:</label>
                            <input type="text" class="form-control" id="apellido"
                                placeholder="Escribe tu Apellido..." required>
                        </div>
                        <div class="mb-3">
                            <label for="telefono" class="form-label">Teléfono:</label>
                            <input type="tel" class="form-control" id="telefono"
                                placeholder="Escribe tu teléfono..." required>
                        </div>
                        <div class="mb-3">
                            <label for="mail" class="form-label">Mail:</label>
                            <input type="email" class="form-control" id="mail" placeholder="Escribe tu mail..." required>
                        </div>
                        <div class="mb-3">
                            <label for="consulta" class="form-label">Consulta:</label>
                            <textarea class="form-control" id="consulta" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <input type="checkbox" id="suscripcion" name="suscripcion" value="suscripcion">
                            <label for="suscripcion"> Quiero recibir promociones y novedades.</label>
                        </div>
                        <div class="botones">
                            <div class="mb-3">
                                <button class="btn btn-primary" type="submit">Enviar</button>
                            </div>
                            <div class="mb-3">
                                <button class="btn btn-primary" type="reset">Borrar</button>

                            </div>
                        </div>
                    </form>
                </div>
                <div class="col mapa">
                    <h1>Dónde estamos</h1>
                    <div class="ratio ratio-16x9">
                        <iframe
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d840.4330054853754!2d-61.17025173025323!3d-32.586670098358965!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x95b61aebfc1131eb%3A0xe694dbf578c2a262!2sMoreno%20Mariano%20%26%20Las%20Heras%2C%20Totoras%2C%20Santa%20Fe!5e0!3m2!1ses-419!2sar!4v1694481818137!5m2!1ses-419!2sar"
                            width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>              
                </div>



            </div>

        </div>
    </section>
    <h1>Comentarios</h1>
    
    <table id="BuscarPorDni">
        <thead>
            <tr>
                
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Comentario</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="contacto in contactos">
                <td>{{ contacto.nombre }}</td>
                <td>{{ contacto.apellido }}</td>
                <td>{{ contacto.consulta }}</td>
                <td><button id="boton-modificar" style="margin-right: 50px;" @click="obtenercontactos2(contacto.codigo)">Modificar</button><!-- <span style="margin-right: 10px;"></span> --></td>

                <td><button id="boton-eliminar" style="margin-right: 50px;" @click="eliminarcontacto(contacto.codigo)">Eliminar</button><!-- <span style="margin-right: 10px;"></span> --></td>
                
            </tr>
        </tbody>
    </table>
    <div v-if="mostrarDatosAmigo">
        <h2>Datos de la consulta</h2>
        <form @submit.prevent="guardarCambios">
            
            <label  class="form-label" for="DNIModificar">DNI:</label>
            <input type="text" id="DNIModificar" v-model="DNI" required><br>
            
            <label  class="form-label" for="nombreModificar">Nombre:</label>
            <input type="text" id="nombreModificar" v-model="nombre" required><br>

            <label  class="form-label" for="apellidoModificar">Apellido:</label>
            <input type="text" id="apellidoModificar" v-model="apellido" required><br>

            <label  class="form-label" for="mailModificar">Mail:</label>
            <input type="email" id="mailModificar" v-model="mail" required><br>

            <label  class="form-label" for="telefonoModificar">Teléfono:</label>
            <input type="tel" id="telefonoModificar" v-model="telefono" required><br>


            <label  class="form-label"  for="ConsultaModificar">Consulta:</label>
            <input type="text" id="ConsultaModificar" v-model="consulta" required><br>


            <button type="submit">Guardar Cambios</button>
            <button @click="cancelar()" type="submit">Cancelar</button>
            
        </form>

</main>
<footer class="footer">
            <div class="f_principal">
                <div class="header-logo"> <a href="index.html"> <img src="./imagenes/Pierrot Logo 2.png" alt="logo"></a></div>
                <div></div>
                <div class="redes">
                    <ul>
                        <li><a href="https://www.instagram.com/pierrottotoras/" target="_blank"><i class="fa-brands fa-instagram fa-xl"></i></a></li>
                        <li><a href="https://m.facebook.com/ChocolatesYHeladosPierrot" target="_blank"><i class="fa-brands fa-square-facebook fa-xl"></i></a></li>
                        <li ><a href="mailto:accettananci@hotmail.com" ><i class="fa-regular fa-envelope fa-xl"></i></a></li>
                        <li><a href="#" target="_blank"><i class="fa-brands fa-whatsapp fa-xl"></i></a></li>
                        <li><a href="tel:+03476461178"><i class="fa-solid fa-phone fa-xl"></i></i></i></a></li>
    
                    </ul>
    
                </div>
            </div>
            <div class="Onediss">
                Desarrollado por OnedissDev 2023 
            </div>
    
        </footer>
        <!-- <script src="./js/validacion.js"></script> -->
    
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/vue@next"></script>
        
   <script >
        const URL = "http://127.0.0.1:5000/"
    
        // Capturamos el evento de envío del formulario
        document.getElementById('formulario').addEventListener('submit', function (event) {
            event.preventDefault(); // Evitamos que se envie el form 
    
            var formData = new FormData();
            /* formData.append('codigo', document.getElementById('codigo').value); */
            formData.append('DNI', document.getElementById('DNI').value);
            formData.append('nombre', document.getElementById('nombre').value);
            formData.append('apellido', document.getElementById('apellido').value);
            formData.append('mail', document.getElementById('mail').value);
            formData.append('telefono', document.getElementById('telefono').value);
            formData.append('consulta', document.getElementById('consulta').value);
            formData.append('suscripcion', document.getElementById('suscripcion').value);
            
            fetch(URL + 'contactos', {
                method: 'POST',
                body: formData // Aquí enviamos formData en lugar de JSON
            })
            .then(function (response) {
                if (response.ok) { return response.json(); }
            })
            .then(function (data) {
                alert('Contacto agregado correctamente.');
                // Limpiar el formulario para el proximo producto
                /* document.getElementById('codigo').value = ""; */
                document.getElementById('DNI').value = "";
                document.getElementById('nombre').value = "";
                document.getElementById('apellido').value = "";
                document.getElementById('mail').value = "";
                document.getElementById('telefono').value = "";
                document.getElementById('consulta').value = "";
                document.getElementById('suscripcion').value = "";
            })
            .catch(function (error) {
                // Mostramos el error, y no limpiamos el form.
                alert('Error al agregar el contacto.');
            });
            bv
        })
    </script>

    <script>
        

            const app = Vue.createApp({
            data() {
                return {
                    contactos: [],
                    codigo: '',
                    nombre: '',
                    apellido: '',
                    mail: '',
                    telefono: '',
                    consulta: '',
                    DNI: '',
                    mostrarDatosAmigo: false,
                }
            },
            methods: {
                obtenercontactos() {
                    // Obtenemos el contenido del inventario
                    fetch(URL + 'contactos')
                        .then(response => {
                             // Parseamos la respuesta JSON 
                            if (response.ok) { return response.json();}
                        })
                        .then(data => {
                            // El código Vue itera este elemento para generar la tabla
                            this.contactos = data;
                            
                        })
                        .catch(error => {
                            console.log('Error:', error);
                            alert('Error al obtener los contactos.');
                        });
                },
                obtenercontactos2(codigo) {
                    // Obtenemos el contenido del inventario
                    fetch(URL + `contactos/${codigo}`)
                        .then(response => {
                             // Parseamos la respuesta JSON 
                            if (response.ok) { return response.json();}
                        })
                        .then(data => {
                            // El código Vue itera este elemento para generar la tabla
                            this.codigo=codigo;
                            
                            this.nombre = data.nombre;
                            this.apellido = data.apellido;
                            this.mail = data.mail;
                            this.telefono = data.telefono;
                            this.consulta = data.consulta;
                            this.DNI = data.DNI;
                            this.mostrarDatosAmigo = true;
                        })
                        .catch(error => {
                            console.log('Error:', error);
                            alert('Error al obtener los contactos.');
                        });
                },
                guardarCambios() {
                    const formData = new FormData();
                    formData.append('codigo', this.codigo);
                    formData.append('nombre', this.nombre);
                    formData.append('apellido', this.apellido);
                    formData.append('mail', this.mail);
                    formData.append('consulta', this.consulta);
                    formData.append('telefono', this.telefono);
                    formData.append('DNI', this.DNI);

                    // if (this.imagenSeleccionada) {
                    //     formData.append('imagen', this.imagenSeleccionada, this.imagenSeleccionada.name);
                    // }

                    fetch(URL + 'contactos/' + this.codigo, {
                        method: 'PUT',
                        body: formData,
                    })
                        .then(response => response.json())
                        .then(data => {
                            alert('Consulta actualizada correctamente');
                            this.limpiarFormulario();
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('Error al actualizar');
                        });
                },
                eliminarcontacto(codigo) {
                    if (confirm('¿Estás seguro de que quieres eliminar este producto?')) {
                        fetch(URL + `contactos/${codigo}`, { method: 'DELETE' })
                            .then(response => {
                                if (response.ok) {
                                    this.contactos = this.contactos.filter(contacto => contacto.codigo !== codigo);
                                    alert('Comentario eliminado correctamente.');
                                }
                            })
                            .catch(error => {
                                alert(error.message);
                            });
                    }
                    
                },
                
                limpiarFormulario() {
                    this.codigo = '';
                    this.nombre = '';
                    this.apellido = '';
                    this.consulta = '';
                    this.mail = '';
                    this.telefono = '';
                    this.DNI = '';
                    this.mostrarDatosAmigo = false;
                },
                cancelar(){
                    this.mostrarDatosAmigo = false;
                    return;
                }
        },
                


            
                
            mounted() {
                //Al cargar la página, obtenemos la lista de productos
                this.obtenercontactos();
            }
        });
        app.mount('body');
    </script>
</body>

</html>